<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Puter.js Claude AI Playground</title>
<script src="https://js.puter.com/v2/"></script>
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<style>
    body {
        font-family: Arial, sans-serif;
        background: #f8f8f8;
        color: #333;
        height: 100vh;
        margin: 0;
        display: flex;
        flex-direction: column;
    }

    header {
        background: white;
        border-bottom: 1px solid #ddd;
        padding: 1rem 2rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .logo {
        font-weight: bold;
        color: #c96;
        font-size: 1.2rem;
    }

    select {
        padding: 0.4rem;
        border-radius: 6px;
        border: 1px solid #ccc;
    }

    .chat-container {
        flex: 1;
        overflow-y: auto;
        padding: 2rem;
        display: flex;
        flex-direction: column;
        gap: 1.5rem;
    }

    .message {
        display: flex;
        gap: 1rem;
    }

    .message.user {
        flex-direction: row-reverse;
    }

    .avatar {
        width: 36px;
        height: 36px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        background: #c96;
        color: #fff;
        font-weight: bold;
    }

    .message.assistant .avatar {
        background: #eee;
        color: #555;
    }

    .message-content {
        background: #fff;
        padding: 1rem;
        border-radius: 12px;
        max-width: 80%;
        box-shadow: 0 1px 3px rgba(0,0,0,0.05);
    }

    .message.user .message-content {
        background: #f0f0f0;
    }

    .typing-indicator span {
        display: inline-block;
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: #999;
        margin: 0 2px;
        animation: bounce 1.2s infinite;
    }

    .typing-indicator span:nth-child(2) { animation-delay: 0.2s; }
    .typing-indicator span:nth-child(3) { animation-delay: 0.4s; }

    @keyframes bounce {
        0%, 80%, 100% { transform: translateY(0); }
        40% { transform: translateY(-6px); }
    }

    .input-container {
        background: white;
        border-top: 1px solid #ddd;
        padding: 1rem 2rem;
        display: flex;
        align-items: center;
        gap: 1rem;
    }

    textarea {
        flex: 1;
        padding: 0.8rem;
        border: 1px solid #ccc;
        border-radius: 8px;
        font-size: 1rem;
        resize: none;
        outline: none;
    }

    button {
        background: #c96;
        border: none;
        color: white;
        padding: 0.8rem 1.2rem;
        border-radius: 8px;
        cursor: pointer;
    }

    button:disabled {
        background: #ccc;
        cursor: not-allowed;
    }

    .error {
        color: #c62828;
        font-weight: bold;
    }

    .empty-state {
        text-align: center;
        color: #777;
        padding: 2rem;
    }
</style>
</head>
<body>

<header>
    <div class="logo">Claude AI via Puter.js</div>
    <div>
        <label for="model">Model:</label>
        <select id="model">
            <option value="claude-sonnet-4">Claude Sonnet 4</option>
            <option value="claude-opus-4">Claude Opus 4</option>
            <option value="claude-opus-4-1">Claude Opus 4.1</option>
            <option value="claude-sonnet-4-5">Claude Sonnet 4.5</option>
            <option value="claude-3-7-sonnet">Claude 3.7 Sonnet</option>
            <option value="claude-3-7-opus">Claude 3.7 Opus</option>
        </select>
    </div>
</header>

<div class="chat-container" id="chatContainer">
    <div class="empty-state">
        <h3>Welcome to Claude AI Playground</h3>
        <p>Type your first message below.</p>
    </div>
</div>

<div class="input-container">
    <textarea id="prompt" placeholder="Message Claude..." rows="1"></textarea>
    <button id="sendBtn">Send</button>
</div>

<script>
const chatContainer = document.getElementById("chatContainer");
const promptEl = document.getElementById("prompt");
const sendBtn = document.getElementById("sendBtn");
const modelEl = document.getElementById("model");

// Render markdown safely
function renderMarkdown(text) {
    return marked.parse(text || "");
}

// Add a chat message bubble
function addMessage(role, content, isTyping = false) {
    const emptyState = chatContainer.querySelector(".empty-state");
    if (emptyState) emptyState.remove();

    const msg = document.createElement("div");
    msg.className = `message ${role}`;

    const avatar = document.createElement("div");
    avatar.className = "avatar";
    avatar.textContent = role === "user" ? "U" : "AI";

    const contentDiv = document.createElement("div");
    contentDiv.className = "message-content";

    if (isTyping) {
        contentDiv.innerHTML = `
            <div class="typing-indicator">
                <span></span><span></span><span></span>
            </div>
        `;
    } else {
        contentDiv.innerHTML = renderMarkdown(content);
    }

    msg.append(avatar, contentDiv);
    chatContainer.appendChild(msg);
    chatContainer.scrollTop = chatContainer.scrollHeight;
    return contentDiv;
}

// Update assistant message content
function updateAssistantMessage(div, text) {
    div.innerHTML = renderMarkdown(text);
    chatContainer.scrollTop = chatContainer.scrollHeight;
}

// Send message
async function sendMessage() {
    const query = promptEl.value.trim();
    if (!query) return;

    const model = modelEl.value;
    addMessage("user", query);
    promptEl.value = "";
    sendBtn.disabled = true;

    const assistantDiv = addMessage("assistant", "", true);
    let collected = "";

    try {
        // Attempt to stream AI response
        const stream = await puter.ai.chat(query, { model, stream: true });

        if (!stream || !stream[Symbol.asyncIterator]) {
            throw new Error("No valid response stream.");
        }

        for await (const chunk of stream) {
            if (chunk?.text) {
                collected += chunk.text;
                updateAssistantMessage(assistantDiv, collected);
            }
        }

        if (!collected.trim()) {
            updateAssistantMessage(assistantDiv, "⚠️ Claude didn’t return a response. Try again.");
        }

    } catch (err) {
        console.error(err);
        assistantDiv.innerHTML = `<p class="error">⚠️ Error: ${err.message || "Connection failed. Please try again."}</p>`;
    } finally {
        sendBtn.disabled = false;
        promptEl.focus();
    }
}

// Auto-resize textarea
promptEl.addEventListener("input", () => {
    promptEl.style.height = "auto";
    promptEl.style.height = Math.min(promptEl.scrollHeight, 200) + "px";
});

// Send on Enter
promptEl.addEventListener("keydown", (e) => {
    if (e.key === "Enter" && !e.shiftKey) {
        e.preventDefault();
        sendMessage();
    }
});

sendBtn.addEventListener("click", sendMessage);
</script>

</body>
</html>
